<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Календарь</title>
    <link href="{{ url_for('static', filename='css/calendar.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='node_modules/air-datepicker/air-datepicker.css') }}" rel="stylesheet">
    <link rel="icon" href="static/img/logo_square3.png">
    <style>
        .air-datepicker.-disabled-range- {
            --adp-cell-background-color-in-range: #eeeeee;
            --adp-cell-background-color-selected: #d0d0d0;
        }
        .text-container {
            margin-top: 30px;
        }

        .container {
            position: relative; /* Делаем контейнер относительным */
        }

        .calendar-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 0px; /* Устанавливаем отступ сверху */
        }
        
        #airdatepicker {
            width: 200px; /* Ширина поля ввода */
            position: relative; /* Позиционируем абсолютно */
            left: 100px; /* Располагаем слева */
            top: -80px; /* Отступ сверху */
            visibility: hidden;
        }
        .buttons-container {
            margin-top: 50px;
            margin-bottom: 100px;
        }

        .buttons-container .btn {
            display: inline-flex; /* Выровнять по одной линии */
            align-items: center;  /* Выровнять по вертикали */
            justify-content: center; /* Центрировать содержимое */
            vertical-align: middle; /* Выровнять по вертикали */
            margin: 0; /* Убираем внешние отступы */
            padding: 0.375rem 0.75rem; /* Задаем одинаковые внутренние отступы */
            height: 38px; /* Установить одинаковую высоту для кнопок */
            line-height: 1.5; /* Установить одинаковую высоту строки */
        }
    </style>
</head>

{% extends 'base.html' %}


{% block content %}
<body>
    <div class="text-container">
        <h2 class="display-6 text-center">Выбор Даты</h2>
    </div>
    
    <div class="calendar-container">
        <input type="calendar" id="airdatepicker" class="form-control">
        <input type="hidden" id="house_id" value="{{ house_id }}">
    </div>
    <div class="buttons-container d-flex gap-2 justify-content-center">
        <a href="/house_selection" class="btn btn-outline-secondary">Назад</a>
        <form action="{{ url_for('main.calendar') }}" method="POST">
            <input type="hidden" name="start_date" id="start_date">
            <input type="hidden" name="end_date" id="end_date">
            <button type="submit" class="btn btn-success-custom">Выбрать</button>
        </form>
    </div>

    <script src="{{ url_for('static', filename='node_modules/air-datepicker/air-datepicker.js') }}"></script>
    <script>
        var unavailableDates = {{ unavailable_dates | tojson }};
        new AirDatepicker('#airdatepicker', {
            position: 'right top',
            range: true,
            inline:true,
            // multipleDatesSeparator: ' - '
            // timepicker: true,
            // Handle render process
            onSelect({date, formattedDate, datepicker}) {
                if (formattedDate.length === 2) {
                    document.getElementById('start_date').value = formattedDate[0];
                    document.getElementById('end_date').value = formattedDate[1];
                }
            },
            onRenderCell({ date, cellType }) {
                if (cellType === 'day') {
                    var month = date.getMonth() + 1;
                    var year = date.getFullYear();
                    var day = date.getDate();
                    var key = `${year}-${month < 10 ? '0' + month : month}-${day < 10 ? '0' + day : day}`;
                    var dates = unavailableDates.filter(date => date.startsWith(key));
                    if (dates.includes(key)) {
                        return {
                            html: '❌',
                            classes: '-emoji-cell-'
                        };
                    }
                }
                return {};
            },
                
            buttons: ['today', 'clear'],
            locale: {
                days: ['Воскресенье', 'Понедельник', 'Вторник', 'Среда', 'Четверг', 'Пятница', 'Суббота'],
                daysShort: ['Вос', 'Пон', 'Вто', 'Сре', 'Чет', 'Пят', 'Суб'],
                daysMin: ['Вс', 'Пн', 'Вт', 'Ср', 'Чт', 'Пт', 'Сб'],
                months: ['Январь', 'Февраль', 'Март', 'Апрель', 'Май', 'Июнь', 'Июль', 'Август', 'Сентябрь', 'Октябрь', 'Ноябрь', 'Декабрь'],
                monthsShort: ['Янв', 'Фев', 'Мар', 'Апр', 'Май', 'Июн', 'Июл', 'Авг', 'Сен', 'Окт', 'Ноя', 'Дек'],
                today: 'Сегодня',
                clear: 'Очистить',
                dateFormat: 'yyyy-MM-dd',
                timeFormat: 'hh:mm aa',
                firstDay: 1
            }
        });
    </script>

    <script src="{{ url_for('static', filename='js/calendar.js') }}"></script>
    
{% endblock %}
</body>
